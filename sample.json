// PREAMBLE
SYSTEM: HR Policy Draft Assistant (Scope-Limited, RAG-Only)

MISSION
You generate professional, empathetic DRAFT email responses to employee HR inquiries using ONLY provided context. Work is limited to: (1) confirm/echo the classified category, (2) surface relevant policy information retrieved/provided in context, and (3) produce an acknowledgment/information-only draft. Drafts are for human review before sending.

HARD SCOPE BOUNDARY (DO NOT DO)
- Do NOT promise, submit, approve, escalate, create tickets/cases, or update systems.
- Do NOT imply routing (“I’ll pass this to…”, “We will fix…”), status changes, or decisions.
- Do NOT invent timelines, links, policies, names, or data.
- Do NOT give legal, medical, or crisis guidance.
- Do NOT use general HR knowledge; use only provided context.

ALLOWED BEHAVIOR
- Acknowledge receipt and restate the request accurately.
- Provide strictly grounded information from policy_context, information_data, resources_data, timeline_data, or next_steps_data.
- Include next steps/timelines ONLY if explicitly provided in context.
- Use neutral, non-committal phrasing (passive voice is preferred).
- Keep body ≤150 words unless policy excerpts require more.

GROUNDING (RAG-STRICT)
- Use ONLY the input context. If a fact/link/policy isn’t in context, do not mention it.
- Quote or paraphrase policy only from provided fields. If a policy/doc identifier is given, reference it exactly as provided.
- If placeholders are required, emit them as [LOOKUP: token] and list them under "lookups_needed".

BLOCK RULES (NEVER GENERATE A DRAFT; RETURN blocked)
1) Forward/chain detected (e.g., "FWD:", "----Original Message----", multiple From:, >>>): block_reason = "Forwarded chain detected - requires human context".
2) Third-person/internal discussion of an employee: block_reason = "Internal discussion - not a direct employee request".
3) Legal/sensitive (lawsuit, attorney, discrimination, harassment, wrongful termination): block_reason = "Legal matter - requires HR specialist review".
4) Medical privacy (conditions, diagnoses, disability details): block_reason = "Medical privacy - requires specialized handling".
5) Crisis language (suicidal, self-harm, threats): block_reason = "Crisis situation - requires immediate human intervention".

CONTEXT SUFFICIENCY
Return insufficient_context if you cannot both (a) identify the request AND (b) provide at least one grounded informational element OR an approved placeholder.
Add category-specific needs ONLY if the category is present. Examples:
- PTO: dates OR relevant policy/timeline/next_steps.
- W2: tax_year OR availability/delivery/timeline info.
- Payroll: issue_type/amount OR review/timeline/resources info.

CLASSIFICATION CONFIDENCE
- If confidence_score < 0.60, set response_type = "review_needed" and clearly state uncertainty in "requires_review".
- Never reclassify; use the provided category and signal uncertainty when low confidence.

INPUT CONTRACT
Required: email_body, sender_email, category, confidence_score, extracted_data
Optional: policy_context, information_data, system_data, timeline_data, next_steps_data, resources_data, required_lookups

RESPONSE STYLE
- Professional, concise, empathetic.
- No commitments or actions. Avoid first-person commitments (“I will…”).
- Use “will be reviewed,” “can be found,” “is available,” etc.
- Only include links/resources exactly as provided.

OUTPUT FORMAT (STRICT JSON; no extra fields)
{
  "status": "generated|blocked|insufficient_context",
  "draft_response": {
    "subject": "string",
    "body": "string",
    "priority": "immediate|high|medium|low",
    "requires_review": ["string"],
    "lookups_needed": ["string"],
    "suggested_send_time": "immediate|business_hours|next_day",
    "context_used": ["email_body","category","confidence_score","extracted_data","policy_context","information_data","system_data","timeline_data","next_steps_data","resources_data","required_lookups"],
    "response_type": "acknowledgment_only|information_provided|review_needed"
  },
  "block_reason": "string|null",
  "insufficient_context_details": {
    "missing_required": ["string"],
    "needed_for": "string"
  },
  "risk_factors": ["string"]
}

DECISION FLOW (APPLY IN ORDER)
1) Block rules → if triggered, output status="blocked".
2) Validate minimum sufficiency → if not met, output status="insufficient_context".
3) Assess confidence_score → if <0.60, set response_type="review_needed" and add reason.
4) Generate concise acknowledgment/information-only draft grounded in provided context.

TEMPLATES (USE ONLY IF SUPPORTED BY CONTEXT)
ACK + INFO
"Thank you for your [request type] regarding [specifics]. [Grounded info from provided context: timelines/policy/resources]. [If provided: next steps]."

ACK + REVIEW NEEDED
"Thank you for reaching out about [topic]. Your request will be reviewed by the appropriate team. [If provided: timeline/resource]. [Any grounded info]."

REMINDERS
- No promises, approvals, or system actions.
- No invented details.
- Keep to acknowledgment + grounded information only.
- Prefer “review_needed” when context is complex, confidence is low, or sensitive signals are present.

// CATEGORIES
{
  "categories": [
    {
      "name": "PTO",
      "description": "Paid time off requests and holiday scheduling.",
      "examples": ["request PTO for 12/24-12/27", "holiday schedule question", "sick day request"],
      "response_data": {
        "urgency": "high",
        "requires_lookup": ["employee_record", "pto_balance", "manager_approval"],
        "common_actions": ["check_balance", "verify_dates", "confirm_manager_approval"],
        "response_templates": ["pto_approved", "pto_pending_manager", "pto_insufficient_balance"],
        "escalation_triggers": ["negative_balance", "blackout_dates", "missing_approval"]
      }
    },
    {
      "name": "W2",
      "description": "W-2 and related tax document requests or issues.",
      "examples": ["need my W-2", "lost tax paperwork", "update address for W2"],
      "response_data": {
        "urgency": "medium",
        "requires_lookup": ["employee_record", "tax_year_docs", "mailing_address"],
        "common_actions": ["verify_identity", "check_address", "resend_document"],
        "response_templates": ["w2_resend", "w2_address_update", "w2_availability"],
        "escalation_triggers": ["multiple_requests", "address_mismatch"]
      }
    },
    {
      "name": "Payroll",
      "description": "Paychecks, time submission, withholdings, direct deposit.",
      "examples": ["paycheck missing", "didn't submit time", "withholding seems wrong"],
      "response_data": {
        "urgency": "high",
        "requires_lookup": ["payroll_records", "timesheet_status", "direct_deposit_info"],
        "common_actions": ["verify_timesheet", "check_pay_period", "review_deductions"],
        "response_templates": ["payroll_investigation", "timesheet_reminder", "direct_deposit_update"],
        "escalation_triggers": ["missing_paycheck", "incorrect_amount", "tax_issues"]
      }
    },
    {
      "name": "Benefits & Enrollment",
      "description": "Health, dental, vision, 401(k), HSA/FSA; enrollments and changes.",
      "examples": ["add newborn to benefits", "FSA rollover question"],
      "response_data": {
        "urgency": "medium",
        "requires_lookup": ["benefits_enrollment", "qualifying_events", "plan_details"],
        "common_actions": ["verify_eligibility", "check_enrollment_period", "process_life_event"],
        "response_templates": ["benefits_enrollment_open", "qualifying_event_process", "plan_comparison"],
        "escalation_triggers": ["deadline_approaching", "complex_medical", "coordination_benefits"]
      }
    },
    {
      "name": "Leaves & Accommodations",
      "description": "FMLA, parental leave, medical leave, ADA accommodations.",
      "examples": ["how to start parental leave", "doctor note for medical leave"],
      "response_data": {
        "urgency": "high",
        "requires_lookup": ["leave_eligibility", "accommodation_history", "legal_requirements"],
        "common_actions": ["initiate_leave_process", "request_documentation", "coordinate_with_legal"],
        "response_templates": ["leave_initiation", "documentation_required", "accommodation_review"],
        "escalation_triggers": ["medical_privacy", "legal_compliance", "discrimination_concern"]
      }
    },
    {
      "name": "Employee Data Changes",
      "description": "Profile updates to address, name, dependents, marital status.",
      "examples": ["legal name change", "new mailing address"],
      "response_data": {
        "urgency": "low",
        "requires_lookup": ["employee_profile", "legal_documentation"],
        "common_actions": ["update_records", "verify_documentation", "notify_departments"],
        "response_templates": ["data_update_confirmed", "documentation_needed", "multi_system_update"],
        "escalation_triggers": ["legal_name_change", "international_address"]
      }
    },
    {
      "name": "HRIS/Portal Access",
      "description": "Issues accessing HR systems (Workday/ADP/UKG/Rippling).",
      "examples": ["can't log in to Workday", "2FA not working for ADP"],
      "response_data": {
        "urgency": "high",
        "requires_lookup": ["account_status", "system_permissions"],
        "common_actions": ["reset_password", "verify_2fa", "check_permissions"],
        "response_templates": ["password_reset_link", "2fa_troubleshoot", "it_ticket_created"],
        "escalation_triggers": ["repeated_lockouts", "system_wide_issue"]
      }
    },
    {
      "name": "Verification & Letters",
      "description": "VOE and official letter requests.",
      "examples": ["employment verification for mortgage", "letter confirming salary"],
      "response_data": {
        "urgency": "medium",
        "requires_lookup": ["employment_dates", "salary_history", "title_history"],
        "common_actions": ["generate_voe", "verify_requester", "send_secure"],
        "response_templates": ["voe_processing", "third_party_verification", "letter_ready"],
        "escalation_triggers": ["salary_dispute", "termination_verification"]
      }
    },
    {
      "name": "Policy & Employee Relations",
      "description": "HR policy questions and workplace concerns.",
      "examples": ["clarify holiday policy", "concern about team conduct"],
      "response_data": {
        "urgency": "variable",
        "requires_lookup": ["policy_database", "previous_incidents", "management_chain"],
        "common_actions": ["provide_policy", "schedule_meeting", "initiate_investigation"],
        "response_templates": ["policy_clarification", "er_investigation_start", "meeting_request"],
        "escalation_triggers": ["harassment", "discrimination", "safety_concern", "legal_threat"]
      }
    },
    {
      "name": "Immigration/Work Authorization",
      "description": "I-9, visa, sponsorship, work authorization updates.",
      "examples": ["I-9 reverification", "visa renewal timing"],
      "response_data": {
        "urgency": "high",
        "requires_lookup": ["i9_status", "visa_expiration", "sponsorship_status"],
        "common_actions": ["verify_dates", "initiate_renewal", "coordinate_with_legal"],
        "response_templates": ["i9_reverification_process", "visa_renewal_timeline", "work_auth_update"],
        "escalation_triggers": ["expiration_imminent", "status_change", "travel_restrictions"]
      }
    },
    {
      "name": "Offboarding/Exit",
      "description": "Resignation, final paycheck, benefits after departure (COBRA).",
      "examples": ["two-week notice submitted", "when will final pay arrive?"],
      "response_data": {
        "urgency": "high",
        "requires_lookup": ["termination_date", "final_pay_calculation", "cobra_eligibility"],
        "common_actions": ["calculate_final_pay", "initiate_cobra", "schedule_exit_interview"],
        "response_templates": ["resignation_acknowledgment", "final_pay_timeline", "cobra_information"],
        "escalation_triggers": ["involuntary_termination", "dispute_final_pay", "non_compete_issue"]
      }
    },
    {
      "name": "Other",
      "description": "General HR inquiries that do not fit the above.",
      "examples": ["not sure which form to use"],
      "response_data": {
        "urgency": "low",
        "requires_lookup": ["context_dependent"],
        "common_actions": ["clarify_request", "route_appropriately"],
        "response_templates": ["general_inquiry", "clarification_needed"],
        "escalation_triggers": ["unclear_intent", "multiple_categories"]
      }
    }
  ]
}
// DET_FILTER
{
  "semantic_config": {
    "hard_exclude": {
      "auto_reply": [
        { "field": "headers.auto-submitted", "operator": "not_equals", "value": "no" },
        { "field": "subject", "operator": "matches", "pattern": "(?i)(out of office|auto.?reply|automatic reply|vacation responder)" }
      ],
      "forwarded_chain": [
        { "field": "subject", "operator": "matches", "pattern": "(?i)^(fwd?:|re:\\s*fwd?:|forwarded)" },
        { "field": "body", "operator": "matches", "pattern": "(?i)(----\\s*original message\\s*----|-+\\s*forwarded message\\s*-+)" },
        { "field": "body", "operator": "matches", "pattern": "(?i)(^|\\n)(from:|sent:|to:|subject:).*(^|\\n)(from:|sent:|to:|subject:)" },
        { "field": "headers.x-forwarded-for", "operator": "exists" }
      ],
      "internal_discussion": [
        { "field": "body", "operator": "matches", "pattern": "(?i)(please (help|assist|respond to) (this employee|this person))" },
        { "field": "body", "operator": "matches", "pattern": "(?i)(can you (handle|take care of|look into) this)" },
        { "field": "body", "operator": "matches", "pattern": "(?i)\\b(FYI|for your (information|action|review))\\b" },
        { "field": "body", "operator": "matches", "pattern": "(?i)(see below|see attached email|per our discussion)" }
      ],
      "mailing_list": [
        { "field": "headers.list-unsubscribe", "operator": "exists" },
        { "field": "headers.list-id", "operator": "exists" },
        { "field": "headers.precedence", "operator": "matches", "pattern": "(?i)(bulk|list)" },
        { "field": "body", "operator": "matches", "pattern": "(?i)unsubscribe" }
      ],
      "bounce": [
        { "field": "from", "operator": "matches", "pattern": "(?i)(mailer-daemon|postmaster)" },
        { "field": "subject", "operator": "matches", "pattern": "(?i)(delivery status notification|undeliverable|mail failure|returned mail)" }
      ],
      "safety_block": [
        { "field": "body", "operator": "matches", "pattern": "(?i)(lawsuit|attorney|legal action|discrimination|harassment|hostile work environment)" },
        { "field": "body", "operator": "matches", "pattern": "(?i)(diagnosis|medical condition|disability|FMLA|workers comp|injury)" },
        { "field": "body", "operator": "matches", "pattern": "(?i)(suicidal|self-harm|threat|crisis)" }
      ]
    },

    "soft_signals": [
      { "id": "emp_domain_from", "family": "employee", "field": "from", "operator": "matches", "pattern": "@company\\.com$", "weight": 2, "cap_per_email": 1, "enabled": true },
      { "id": "emp_signature", "family": "employee", "field": "body", "operator": "matches", "pattern": "@company\\.com", "weight": 2, "cap_per_email": 1, "enabled": true },
      { "id": "emp_manager", "family": "employee", "field": "body", "operator": "matches", "pattern": "(?i)(my manager|approved by|people manager)", "weight": 1, "cap_per_email": 1, "enabled": true },
      { "id": "emp_tools", "family": "employee", "field": "body", "operator": "matches", "pattern": "(?i)(Workday|ADP|UKG|Rippling|HR portal)", "weight": 1, "cap_per_email": 2, "enabled": true },

      { "id": "chain_indicator", "family": "chain_forward", "field": "body", "operator": "matches", "pattern": "(?i)(>\\s*from:|>\\s*sent:|>\\s*subject:|>{2,})", "weight": -4, "cap_per_email": 1, "enabled": true },
      { "id": "third_person_ref", "family": "chain_forward", "field": "body", "operator": "matches", "pattern": "(?i)\\b(this employee|this person|the employee)\\b", "weight": -3, "cap_per_email": 2, "enabled": true },
      { "id": "internal_routing", "family": "chain_forward", "field": "body", "operator": "matches", "pattern": "(?i)(please handle|can you help with|take a look at this|see email below|forwarding to you)", "weight": -3, "cap_per_email": 1, "enabled": true },
      { "id": "email_quotes", "family": "chain_forward", "field": "body", "operator": "matches", "pattern": "(?:^|\\n)\\s*>[>\\s]*.{20,}", "weight": -2, "cap_per_email": 3, "enabled": true },
      { "id": "multiple_senders", "family": "chain_forward", "field": "body", "operator": "matches", "pattern": "From:.*From:", "weight": -4, "cap_per_email": 1, "enabled": true },

      { "id": "first_person_request", "family": "direct_request", "field": "body", "operator": "matches", "pattern": "(?i)\\b(I (need|would like|am requesting|can'?t access|want to)|my (pto|paycheck|benefits))\\b", "weight": 3, "cap_per_email": 2, "enabled": true },
      { "id": "direct_question", "family": "direct_request", "field": "body", "operator": "matches", "pattern": "(?i)^(can I|could I|how do I|when can I|what is my|where is my|why is my)", "weight": 2, "cap_per_email": 1, "enabled": true },

      { "id": "topic_pto", "family": "hr_topics", "field": "body", "operator": "matches", "pattern": "(?i)\\b(PTO|paid time off|vacation|holiday|sick (day|leave))\\b", "weight": 2, "cap_per_email": 2, "enabled": true },
      { "id": "topic_w2", "family": "hr_topics", "field": "body", "operator": "matches", "pattern": "(?i)\\b(W-?2|tax (form|paperwork|document))\\b", "weight": 2, "cap_per_email": 2, "enabled": true },
      { "id": "topic_payroll", "family": "hr_topics", "field": "body", "operator": "matches", "pattern": "(?i)\\b(payroll|paycheck|direct deposit|timesheet|timecard|didn'?t submit time)\\b", "weight": 2, "cap_per_email": 2, "enabled": true },

      { "id": "nonemp_marketing", "family": "non_employee", "field": "body", "operator": "matches", "pattern": "(?i)(free trial|demo|pricing|quote(?: request)?|our services|newsletter)", "weight": -3, "cap_per_email": 1, "enabled": true },
      { "id": "nonemp_unsub", "family": "non_employee", "field": "body", "operator": "matches", "pattern": "(?i)unsubscribe", "weight": -3, "cap_per_email": 1, "enabled": true },

      { "id": "soft_auto_reply_text", "family": "auto_reply", "field": "body", "operator": "matches", "pattern": "(?i)(out of office|automatic reply)", "weight": -3, "cap_per_email": 1, "enabled": true },

      { "id": "pii_ssn", "family": "pii", "field": "body", "operator": "matches", "pattern": "\\b\\d{3}-\\d{2}-\\d{4}\\b", "weight": -4, "cap_per_email": 1, "enabled": true },
      { "id": "pii_bank", "family": "pii", "field": "body", "operator": "matches", "pattern": "(?i)(routing number|account number|direct deposit form)", "weight": -3, "cap_per_email": 1, "enabled": true },

      { "id": "legal_language", "family": "reply_safety", "field": "body", "operator": "matches", "pattern": "(?i)(lawsuit|attorney|legal action|discrimination|harassment|hostile work environment)", "weight": -5, "action": "escalate_to_human", "no_auto_reply": true, "cap_per_email": 1, "enabled": true },
      { "id": "medical_detail", "family": "reply_safety", "field": "body", "operator": "matches", "pattern": "(?i)(diagnosis|medical condition|disability|FMLA|workers comp|injury)", "weight": -3, "action": "review_before_reply", "no_auto_reply": true, "cap_per_email": 1, "enabled": true },
      { "id": "termination_language", "family": "reply_safety", "field": "body", "operator": "matches", "pattern": "(?i)(wrongful termination|unfair dismissal|constructive dismissal|severance dispute)", "weight": -5, "action": "escalate_to_human", "no_auto_reply": true, "cap_per_email": 1, "enabled": true },
      { "id": "emotional_distress", "family": "reply_safety", "field": "body", "operator": "matches", "pattern": "(?i)(emotional distress|mental health crisis|suicidal|self-harm|threat)", "weight": -5, "action": "immediate_escalation", "no_auto_reply": true, "cap_per_email": 1, "enabled": true }
    ],

    "thresholds": {
      "keep_min": 4,
      "review_min": 2,
      "floor": -6,
      "cap_total": 10,
      "auto_reply_min": 6,
      "no_reply_max": -2
    },

    "guards": {
      "cap_per_family": {
        "employee": 3,
        "hr_topics": 3,
        "non_employee": 2,
        "pii": 2,
        "reply_safety": 2,
        "chain_forward": 3,
        "direct_request": 2
      },
      "generator_gate": {
        "min_confidence_for_generation": 0.60,
        "block_if_hard_exclude_present": true,
        "block_if_reply_safety_no_auto_reply": true,
        "require_email_type": "direct_request"
      },
      "notes": "Headers may be absent; rely on subject/body patterns and signatures. Hard excludes cover auto-replies, lists, and bounces. Reply safety signals prevent inappropriate auto-responses. Detects forwarded chains and internal discussions to prevent auto-response. Direct first-person requests score higher."
    }
  }
}
// POLICY_FILTER
{
  "policy_config": {
    "phase": "shadow_alpha_testing",
    "send_policy": { "mode": "draft_only" },

    "schema": {
      "decision": ["IRRELEVANT", "REVIEW", "KEEP"],
      "confidence_range": [0, 1],
      "category": ["PTO", "W2", "Payroll", "Benefits & Enrollment", "Leaves & Accommodations", "Employee Data Changes", "HRIS/Portal Access", "Verification & Letters", "Policy & Employee Relations", "Immigration/Work Authorization", "Offboarding/Exit", "Other"],
      "response_eligibility": ["auto_reply", "assisted_reply", "human_only", "no_reply"],
      "email_type": ["direct_request", "forwarded_chain", "internal_discussion", "cc_consultation"]
    },

    "purpose": "Evaluate emails upstream to filter out chains/internal discussions/sensitive topics, classify category, and decide whether to generate a draft-only acknowledgment/information response.",
    "company": {
      "domains": ["@company.com", "@subsidiary.com"],
      "hr_topics": ["pto", "paid time off", "vacation", "holiday", "leave", "w-2", "w2", "tax", "payroll", "paycheck", "timesheet", "timecard", "direct deposit", "benefits", "address change"]
    },

    "min_confidence_for_generation": 0.60,
    "confidence_thresholds": {
      "auto_reply_as_draft_only": 0.85,
      "assisted_reply_as_draft_only": 0.70
    },

    "chain_detection": {
      "indicators": {
        "forwarded": [
          "Subject starts with Fwd: or FW:",
          "Contains '---- Original Message ----'",
          "Multiple 'From:' headers in body",
          "Quoted email indicators (> symbols)",
          "Contains 'Begin forwarded message'"
        ],
        "internal_discussion": [
          "Third-person references to employee",
          "Manager discussing employee issue",
          "HR-to-HR communication patterns",
          "'Please help this person' language",
          "FYI or 'for your review' phrases"
        ],
        "cc_consultation": [
          "Multiple recipients in CC",
          "HR team members in CC",
          "Manager CC'd on employee request"
        ]
      },
      "rules": {
        "forwarded_chain": {
          "decision": "REVIEW",
          "response_eligibility": "human_only",
          "generator_pass": false,
          "note": "Forwarded emails require human context; block responder."
        },
        "internal_discussion": {
          "decision": "REVIEW",
          "response_eligibility": "no_reply",
          "generator_pass": false,
          "note": "Internal discussions never auto-respond; block responder."
        },
        "direct_request": {
          "continue_normal_evaluation": true,
          "note": "Direct employee requests may proceed if other gates pass."
        }
      }
    },

    "safety_gates": {
      "legal_language": { "generator_pass": false, "response_eligibility": "human_only" },
      "medical_detail": { "generator_pass": false, "response_eligibility": "human_only" },
      "crisis_language": { "generator_pass": false, "response_eligibility": "human_only" },
      "pii_financial": { "generator_pass": true, "response_eligibility": "assisted_reply" }
    },

    "extraction_patterns": {
      "dates": "\\b(\\d{1,2}/\\d{1,2}(?:/\\d{2,4})?|Jan(?:uary)?|Feb(?:ruary)?|Mar(?:ch)?|Apr(?:il)?|May|Jun(?:e)?|Jul(?:y)?|Aug(?:ust)?|Sep(?:tember)?|Oct(?:ober)?|Nov(?:ember)?|Dec(?:ember)?)\\s*\\d{1,2}(?:st|nd|rd|th)?(?:[,\\s]+\\d{2,4})?\\b",
      "date_ranges": "(?:from|between)\\s*([^to\\n]+)\\s*(?:to|through|-|and)\\s*([^.,;\\n]+)",
      "tax_year": "(?i)\\b20\\d{2}\\b",
      "purpose": "(?i)\\b(visa|mortgage|apartment|loan|background check|employment verification|proof of employment)\\b",
      "system": "(?i)\\b(Workday|ADP|UKG|Rippling|BambooHR|SuccessFactors|Oracle HCM)\\b",
      "issue_type": "(?i)\\b(password|locked out|can'?t access|underpayment|missing hours|direct deposit|address change)\\b",
      "employee_id": "\\b[Ee]mp(?:loyee)?\\s*(?:ID|#)?\\s*[:]*\\s*(\\d{5,7})\\b",
      "dollar_amounts": "\\$[\\d,]+(?:\\.\\d{2})?",
      "manager_names": "(?:manager|supervisor|lead)\\s+(?:is\\s+)?([A-Z][a-z]+\\s+[A-Z][a-z]+)",
      "phone_numbers": "\\b(?:\\+1[-.]?)?\\(?\\d{3}\\)?[-.]?\\d{3}[-.]?\\d{4}\\b",
      "email_addresses": "\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}\\b",
      "original_sender": "(?:^|\\n)From:\\s*([^\\n]+)",
      "forward_indicators": "(?i)(^|\\n)(fwd?:|re:\\s*fwd?:)|>>>>|----\\s*original",
      "chain_depth": "(?:^|\\n)\\s*>\\s*>+",
      "third_person_refs": "(?i)\\b(this employee|this person|the employee)\\b",
      "first_person_request": "(?i)\\b(I\\s+(need|would like|am requesting|can't access|can'?t access|want to)|my\\s+(pto|paycheck|benefits))\\b"
    },

    "response_rules": {
      "auto_reply_eligible": {
        "categories": ["PTO", "W2", "Verification & Letters", "HRIS/Portal Access"],
        "confidence_threshold": 0.85,
        "email_type_required": "direct_request",
        "required_extractions": {
          "PTO": ["dates"],
          "W2": ["tax_year"],
          "Verification & Letters": ["purpose"],
          "HRIS/Portal Access": ["system", "issue_type"]
        },
        "generator_mode": "draft_only"
      },
      "assisted_reply": {
        "categories": ["Payroll", "Benefits & Enrollment", "Employee Data Changes"],
        "confidence_threshold": 0.70,
        "email_type_required": "direct_request",
        "review_triggers": ["dollar_amounts", "multiple_issues", "unclear_request"],
        "generator_mode": "draft_only"
      },
      "human_only": {
        "categories": ["Leaves & Accommodations", "Policy & Employee Relations", "Immigration/Work Authorization", "Offboarding/Exit"],
        "email_types": ["forwarded_chain", "cc_consultation"],
        "escalation_triggers": ["legal_language", "medical_detail", "termination", "discrimination"],
        "generator_mode": "blocked"
      },
      "no_reply": {
        "categories": ["IRRELEVANT"],
        "email_types": ["internal_discussion"],
        "conditions": ["auto_reply", "marketing", "bounce", "spam", "forwarded_without_context"],
        "generator_mode": "blocked"
      }
    },

    "response_timing": {
      "immediate": ["HRIS/Portal Access"],
      "business_hours_only": ["PTO", "W2", "general_inquiry"],
      "delay_24h": ["Offboarding/Exit", "final_paycheck"],
      "never_auto": ["Policy & Employee Relations", "legal_concerns", "medical_leave", "forwarded_chain", "internal_discussion"]
    },

    "reply_complexity": {
      "simple": { "complexity_signals": ["routine_dates", "known_system", "single_issue"], "avg_triage_time": "< 5 minutes" },
      "moderate": { "complexity_signals": ["requires_lookup", "multiple_fields", "policy_reference"], "avg_triage_time": "15-30 minutes" },
      "complex": { "complexity_signals": ["multi_policy", "ambiguous_request", "missing_info"], "avg_triage_time": "1-2 hours" },
      "escalate": { "complexity_signals": ["legal", "medical", "crisis", "forwarded_chain_resolution"], "avg_triage_time": "immediate human review" }
    },

    "context_requirements": {
      "global_minimum": ["can_identify_request", "one_grounded_info_or_placeholder"],
      "by_category": {
        "PTO": ["dates_or_policy_or_timeline_or_next_steps"],
        "W2": ["tax_year_or_availability_or_delivery_or_timeline"],
        "Payroll": ["issue_type_or_review_or_timeline_or_resources"]
      }
    },

    "output_format": {
      "structure": {
        "decision": "IRRELEVANT|REVIEW|KEEP",
        "confidence": "number 0..1",
        "category": "string or null",
        "email_type": "direct_request|forwarded_chain|internal_discussion|cc_consultation",
        "response_eligibility": "auto_reply|assisted_reply|human_only|no_reply",
        "extracted_data": {
          "dates": ["array"],
          "employee_id": "string or null",
          "manager_name": "string or null",
          "dollar_amounts": ["array"],
          "systems_mentioned": ["array"],
          "original_sender": "string or null",
          "chain_detected": "boolean"
        },
        "response_priority": "immediate|high|medium|low",
        "suggested_template": "string or null",
        "required_lookups": ["array"],
        "matched_signals": ["array"],
        "escalation_reasons": ["array"],
        "reasons": ["array"],
        "generator_hint": "blocked|draft_only|pass"
      },
      "instructions": "Return ONLY valid JSON matching the structure. No additional text."
    },

    "generator_gate": {
      "pass_conditions": [
        "decision == 'KEEP'",
        "email_type == 'direct_request'",
        "confidence >= min_confidence_for_generation",
        "response_eligibility in ['auto_reply','assisted_reply']",
        "no safety_gates with generator_pass=false"
      ],
      "blocked_conditions": [
        "email_type in ['forwarded_chain','internal_discussion']",
        "safety_gates.legal_language || safety_gates.medical_detail || safety_gates.crisis_language",
        "response_eligibility in ['human_only','no_reply']"
      ],
      "modes": {
        "auto_reply": "draft_only",
        "assisted_reply": "draft_only",
        "human_only": "blocked",
        "no_reply": "blocked"
      }
    },

    "examples": []
  }
}

// RESP_TEMP
{
  "response_templates": {
    "pto_approved": {
      "subject": "PTO Request Confirmation - {dates}",
      "body": "Your PTO request for {dates} has been confirmed. Manager approval from {manager_name} has been verified in {system}. Your remaining PTO balance is {balance} hours.",
      "required_data": ["dates", "manager_name", "system", "balance"]
    },
    "pto_pending_manager": {
      "subject": "PTO Request - Pending Manager Approval",
      "body": "Your PTO request for {dates} has been received. We're awaiting manager approval. You'll receive confirmation within 24 business hours.",
      "required_data": ["dates"]
    },
    "w2_resend": {
      "subject": "W-2 Reissue Request Processed",
      "body": "Your {tax_year} W-2 will be {delivery_method} within 3-5 business days to {address}. Please verify your address is correct in {system}.",
      "required_data": ["tax_year", "delivery_method", "address", "system"]
    },
    "escalation_human": {
      "subject": "Your HR Request - Personal Attention Required",
      "body": "Thank you for contacting HR. Your request requires personal attention from our team. An HR representative will contact you within {timeframe}.",
      "required_data": ["timeframe"]
    }
  }
}
